<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to cregg • cregg</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to cregg">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cregg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction.html">Introduction to cregg</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/leeper/cregg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to cregg</h1>
            
            <h4 class="date">2019-04-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/leeper/cregg/blob/master/vignettes/Introduction.Rmd"><code>vignettes/Introduction.Rmd</code></a></small>
      <div class="hidden name"><code>Introduction.Rmd</code></div>

    </div>

    
    
<p>This vignette provides an introduction to <strong>cregg</strong>, a package for analyzing and visualizing the results of conjoint experiments, which are factorial discrete choice experiments that are increasingly popular in the political and social sciences for studying decision making and preferences over multidimensional issues. cregg provides functionality that is useful for analyzing and otherwise examining data from these designs, namely:</p>
<ul>
<li>Estimation of average marginal component effects (AMCEs) for fully randomized conjoint designs (as well as designs involving an unlimited number of two-way constraints between features) and munging of AMCE estimates into tidy data frames, via <code><a href="../reference/amce.html">amce()</a></code>
</li>
<li>Calculation of marginal means (MMs) for conjoint designs and munging them into tidy data frames via <code><a href="../reference/mm.html">mm()</a></code>
</li>
<li>Tabulation of display frequencies of feature attributes via <code><a href="../reference/cj_freqs.html">cj_table()</a></code> and <code><a href="../reference/cj_freqs.html">cj_freqs()</a></code> and cross-tabulation of feature restrictions using <code><a href="../reference/cj_freqs.html">cj_props()</a></code>
</li>
<li>Tidying of raw “wide”-format conjoint survey datasets into “long” or “tidy” datasets using <code><a href="../reference/cj_tidy.html">cj_tidy()</a></code>
</li>
</ul>
<p>In addition, the package provides a number of tools that are likely useful to conjoint analysts:</p>
<ul>
<li>
<strong>ggplot2</strong>-based visualizations of AMCEs and MMs, via <code><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot()</a></code> methods for all of the above</li>
<li>Tidying of raw “wide”-format conjoint survey datasets into “long” or “tidy” datasets using <code><a href="../reference/cj_tidy.html">cj_tidy()</a></code>
</li>
<li>Diagnostics to choose feature reference categories, via <code><a href="../reference/amce.html">amce_by_reference()</a></code>
</li>
</ul>
<p>To demonstrate package functionality, the package includes three example datasets:</p>
<ul>
<li>
<code>taxes</code>, a full randomized choice task conjoint experiment conducted by Ballard-Rosa et al. (2016)</li>
<li>
<code>immigration</code>, a partial factorial conjoint experiment with several restrictions between features conducted by Hainmueller, Hopkins, and Yamamoto (2014)</li>
<li>
<code>conjoint_wide</code>, a simulated “wide”-format conjoint dataset that is used to demonstrate functionality of <code><a href="../reference/cj_tidy.html">cj_tidy()</a></code>
</li>
</ul>
<p>The design of cregg follows a few key principles:</p>
<ul>
<li>Following tidy data principles throughout, so that all of the main functions produce consistently structured, metadata-rich data frames. Thus the response from any function is a tidy data frame that can easily be stacked with others (e.g., for computing AMCEs for subsets of respondents) and then producing ggplot2 visualizations.</li>
<li>A formula-based interface that meshes well with the underlying <a href="https://cran.r-project.org/package=survey"><strong>survey</strong></a>-based effect estimation API.</li>
<li>A consistent interface for both unconstrained and two-way constrained designs that relies only on formula notation without any package-specific “design” specification. Conjoint designs involving two-way constraints between features are easily supported using simple formula notation: <code>Y ~ A + B + C</code> implies an unconstrained design, while <code>Y ~ A * B + C</code> implies a constraint between levels of features A and B. cregg figures out the constrained level pairs automatically without needing to further specify them explicitly.</li>
</ul>
<p>cregg also provides some sugar:</p>
<ul>
<li>Using “label” attributes on variables to provide pretty printing, with options to relabel features or plots on the fly</li>
<li>Using factor base levels rather than trying to set baseline levels atomically</li>
<li>A convenient API (via the <code><a href="../reference/cregg.html">cj(..., by = ~ group)</a></code> idiom) for repeated, subgroup operations without the need for <code><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply()</a></code> or <code>for</code> loops</li>
<li>All functions have arguments in data-formula order, making it simple to pipe into them via the magrittr pipe (<code>%&gt;%</code>).</li>
</ul>
<p>The package, whose primary point of contact is <code><a href="../reference/cregg.html">cj()</a></code>, takes its name from the surname of a famous White House Press Secretary.</p>
<p>Contributions and feedback are welcome on <a href="https://github.com/leeper/cregg/issues">GitHub</a>.</p>
<div id="code-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#code-examples" class="anchor"></a>Code Examples</h2>
<p>The package includes several example conjoint datasets, which are used here and in examples:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"cregg"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"immigration"</span>)</code></pre></div>
<div id="marginal-means" class="section level3">
<h3 class="hasAnchor">
<a href="#marginal-means" class="anchor"></a>Marginal Means</h3>
<p>The package provides straightforward calculation and visualization of descriptive marginal means (MMs). These represent the mean outcome across all appearances of a particular conjoint feature level, averaging across all other features. In forced choice conjoint designs with two profiles per choice task, MMs by definition average 0.5 with values above 0.5 indicating features that increase profile favorability and values below 0.5 indicating features that decrease profile favorability. (They will average 0.33 in designs with three profiles, 0.25 with four profiles, etc.) For continuous/ordinal outcomes, MMs can take any value in the full range of the outcome. Calculation of MMs entail no modelling assumptions are simply descriptive quantities of interest:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># descriptive plotting</span>
f1 &lt;-<span class="st"> </span>ChosenImmigrant <span class="op">~</span><span class="st"> </span>Gender <span class="op">+</span><span class="st"> </span>LanguageSkills <span class="op">+</span><span class="st"> </span>PriorEntry <span class="op">+</span><span class="st"> </span>Education <span class="op">*</span><span class="st"> </span>Job <span class="op">+</span><span class="st"> </span>CountryOfOrigin <span class="op">*</span><span class="st"> </span>ReasonForApplication <span class="op">+</span><span class="st"> </span>
<span class="st">    </span>JobExperience <span class="op">+</span><span class="st"> </span>JobPlans
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../reference/mm.html">mm</a></span>(immigration, f1, <span class="dt">id =</span> <span class="op">~</span>CaseID), <span class="dt">vline =</span> <span class="fl">0.5</span>)</code></pre></div>
<p><img src="Introduction_files/figure-html/mmplot-1.png" width="960"></p>
<p>cregg functions use <code><a href="https://www.rdocumentation.org/packages/base/topics/attr">attr(data$feature, "label")</a></code> to provide pretty printing of feature labels, so that variable names can be arbitrary. These can be overwritten using the <code>feature_labels</code> argument to override these settings within cregg functions. (To overwrite/create feature labels permanently, use for example <code>attr(immigration$LanguageSkills, "label") &lt;- "English Proficiency"</code>.) Feature levels are always deduced from the <code><a href="https://www.rdocumentation.org/packages/base/topics/levels">levels()</a></code> of righthand-side variables in the model specification. All variables should be factors with levels in desired display order. Similarly, the plotted order of features is given by the order of terms in the RHS formula unless overridden by the order of variable names given in <code>feature_order</code>.</p>
</div>
<div id="marginal-effects" class="section level3">
<h3 class="hasAnchor">
<a href="#marginal-effects" class="anchor"></a>Marginal Effects</h3>
<p>A more common analytic approach for conjoints is to estimate average marginal component effects (AMCEs) using some form of regression analysis. cregg uses <code><a href="https://www.rdocumentation.org/packages/stats/topics/glm">glm()</a></code> and <code>svyglm()</code> to perform estimation and <a href="https://cran.r-project.org/package=margins">margins</a> to generate average marginal effect estimates. Designs can be specified with any interactions between conjoint features but only AMCEs are returned. Any terms that linked by a <code>*</code> in the formula are treated as design constraints and AMCEs are estimated cognizant of these constraints; only two-way interactions are supported, however. Just like for <code><a href="../reference/mm.html">mm()</a></code>, the output of <code><a href="../reference/cregg.html">cj()</a></code> (or its alias, <code><a href="../reference/amce.html">amce()</a></code>) is a tidy data frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimation</span>
amces &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cregg.html">cj</a></span>(immigration, f1, <span class="dt">id =</span> <span class="op">~</span>CaseID)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(amces[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"feature"</span>, <span class="st">"level"</span>, <span class="st">"estimate"</span>, <span class="st">"std.error"</span>)], 20L)</code></pre></div>
<pre><code>                  feature                    level     estimate   std.error
1                  Gender                   Female  0.000000000          NA
2                  Gender                     Male -0.026023159 0.008012413
3         Language Skills           Fluent English  0.000000000          NA
4         Language Skills           Broken English -0.056319723 0.011312971
5         Language Skills Tried English but Unable -0.126359527 0.011370259
6         Language Skills         Used Interpreter -0.159740917 0.011589128
7             Prior Entry                    Never  0.000000000          NA
8             Prior Entry          Once as Tourist  0.055954954 0.012463168
9             Prior Entry    Many Times as Tourist  0.054748425 0.012912603
10            Prior Entry   Six Months with Family  0.075317887 0.012603718
11            Prior Entry   Once w/o Authorization -0.110084275 0.013026767
12 Educational Attainment                No Formal  0.000000000          NA
13 Educational Attainment                4th Grade  0.033068508 0.014906199
14 Educational Attainment                8th Grade  0.057744013 0.014945344
15 Educational Attainment              High School  0.119483476 0.014963743
16 Educational Attainment         Two-Year College  0.163405352 0.022955261
17 Educational Attainment           College Degree  0.190036705 0.023015067
18 Educational Attainment          Graduate Degree  0.176068029 0.016908355
19                    Job                  Janitor  0.000000000          NA
20                    Job                   Waiter -0.006814709 0.016605007</code></pre>
<p>This makes it very easy to modify, combine, print, etc. the resulting output. It also makes it easy to visualize using ggplot2. A convenience visualization function is provided:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plotting of AMCEs</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(amces)</code></pre></div>
<p><img src="Introduction_files/figure-html/plot_amce-1.png" width="960"></p>
</div>
<div id="reference-category-diagnostics-for-amces" class="section level3">
<h3 class="hasAnchor">
<a href="#reference-category-diagnostics-for-amces" class="anchor"></a>Reference Category Diagnostics for AMCEs</h3>
<p>Reference categories for AMCEs are often arbitrary and can affect intuitions about results, so the package also provides a diagnostic tool for helping to decide on an appropriate reference category:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">amce_diagnostic &lt;-<span class="st"> </span><span class="kw"><a href="../reference/amce.html">amce_by_reference</a></span>(immigration, ChosenImmigrant <span class="op">~</span><span class="st"> </span>LanguageSkills, <span class="op">~</span>LanguageSkills, <span class="dt">id =</span> <span class="op">~</span>CaseID)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(amce_diagnostic, <span class="dt">group =</span> <span class="st">"BY"</span>, <span class="dt">legend_title =</span> <span class="st">"Reference Category"</span>)</code></pre></div>
<p><img src="Introduction_files/figure-html/amce_diagnostic-1.png" width="960"></p>
<p>The reference category can be specified directly using <code><a href="https://www.rdocumentation.org/packages/stats/topics/relevel">relevel(data$feature, "New reference category")</a></code>. This may result in levels not being plotted in the desired order, however, in which case the entire feature can be reordered and plotted with a new reference category:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate marginal means and order output by estimate</span>
country_mms &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mm.html">mm</a></span>(immigration, ChosenImmigrant <span class="op">~</span><span class="st"> </span>CountryOfOrigin, <span class="dt">id =</span> <span class="op">~</span>CaseID)
country_mms &lt;-<span class="st"> </span>country_mms[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/order">order</a></span>(country_mms<span class="op">$</span>estimate), ]
<span class="co"># reorder feature in preference ascending order</span>
immigration<span class="op">$</span>CountryOfOrigin2 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(immigration<span class="op">$</span>CountryOfOrigin, <span class="dt">levels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Iraq"</span>, <span class="st">"Somalia"</span>, <span class="st">"Sudan"</span>, <span class="st">"China"</span>, <span class="st">"India"</span>, 
    <span class="st">"Mexico"</span>, <span class="st">"France"</span>, <span class="st">"Poland"</span>, <span class="st">"Philippines"</span>, <span class="st">"Germany"</span>))
country2_amces &lt;-<span class="st"> </span><span class="kw"><a href="../reference/amce.html">amce</a></span>(immigration, ChosenImmigrant <span class="op">~</span><span class="st"> </span>CountryOfOrigin2, <span class="dt">id =</span> <span class="op">~</span>CaseID)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(country2_amces)</code></pre></div>
<p><img src="Introduction_files/figure-html/reorder-1.png" width="960"></p>
<p>which is useful to generate easily interpretable plots in which otherwise unordered features are ordered according to preferences.</p>
</div>
</div>
<div id="subgroup-analyis" class="section level2">
<h2 class="hasAnchor">
<a href="#subgroup-analyis" class="anchor"></a>Subgroup Analyis</h2>
<p>While the reference category has no meaningful bearing on estimation, it can affect inferences especially when subgroups are compared. For this reason, it can be useful to assess the substantive inferences from different reference categories alongside any subgroup analysis. To provide simple subgroup analyses, the <code><a href="../reference/cregg.html">cj()</a></code> function provides a <code>by</code> argument to iterate over subsets of <code>data</code> and calculate AMCEs or MMs on each subgroup.</p>
<div id="subgroup-marginal-means" class="section level3">
<h3 class="hasAnchor">
<a href="#subgroup-marginal-means" class="anchor"></a>Subgroup Marginal Means</h3>
<p>For example, we may want to ensure that there are no substantial variations in preferences within-respondents across multiple conjoint decision tasks:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mm_by &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cregg.html">cj</a></span>(immigration, ChosenImmigrant <span class="op">~</span><span class="st"> </span>Gender <span class="op">+</span><span class="st"> </span>Education <span class="op">+</span><span class="st"> </span>LanguageSkills, <span class="dt">id =</span> <span class="op">~</span>CaseID, <span class="dt">estimate =</span> <span class="st">"mm"</span>, <span class="dt">by =</span> <span class="op">~</span>contest_no)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(mm_by, <span class="dt">group =</span> <span class="st">"BY"</span>, <span class="dt">vline =</span> <span class="fl">0.5</span>)</code></pre></div>
<p><img src="Introduction_files/figure-html/mm_by-1.png" width="960"></p>
</div>
<div id="tests-of-preference-heterogeneity" class="section level3">
<h3 class="hasAnchor">
<a href="#tests-of-preference-heterogeneity" class="anchor"></a>Tests of Preference Heterogeneity</h3>
<p>A more formal test of these differences is provided by a nested model comparison test:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/diffs.html">cj_anova</a></span>(immigration, ChosenImmigrant <span class="op">~</span><span class="st"> </span>Gender <span class="op">+</span><span class="st"> </span>Education <span class="op">+</span><span class="st"> </span>LanguageSkills, <span class="dt">by =</span> <span class="op">~</span>contest_no)</code></pre></div>
<pre><code>Analysis of Deviance Table

Model 1: ChosenImmigrant ~ Gender + Education + LanguageSkills
Model 2: ChosenImmigrant ~ Gender + Education + LanguageSkills + contest_no + 
    Gender:contest_no + Education:contest_no + LanguageSkills:contest_no
  Resid. Df Resid. Dev Df Deviance      F Pr(&gt;F)
1     13949     3353.0                          
2     13938     3349.6 11   3.3873 1.2814 0.2279</code></pre>
<p>which provides a test of whether any of the interactions between the <code>by</code> variable and feature levels differ from zero.</p>
</div>
<div id="differences-in-conditional-amces" class="section level3">
<h3 class="hasAnchor">
<a href="#differences-in-conditional-amces" class="anchor"></a>Differences in Conditional AMCEs</h3>
<p>And, finally, while it is increasingly common to present grouped dot-and-whisker charts as comparisons of subgroup AMCEs, that comparison can be misleading of preferences differ substantially in the reference category. When that occurs, similar AMCEs do not necessarily mean similar preferences; this is a subtle distinction that must be respected when engaging in <em>descriptive</em> as opposed to <em>causal</em> interpretation of conjoint results.</p>
<p>For example, we might want to understand differences in preferences by ethnocentrism, which can most clearly be seen in a subgroup MM plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## the original plot is split at the value of 10, which is not a true median split
immigration<span class="op">$</span>ethnosplit &lt;-<span class="st"> </span><span class="ot">NA_real_</span>
immigration<span class="op">$</span>ethnosplit[immigration<span class="op">$</span>ethnocentrism <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>] &lt;-<span class="st"> </span>1L
immigration<span class="op">$</span>ethnosplit[immigration<span class="op">$</span>ethnocentrism <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>] &lt;-<span class="st"> </span>2L
immigration<span class="op">$</span>ethnosplit &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(immigration<span class="op">$</span>ethnosplit, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Low Ethnocentrism"</span>, <span class="st">"High Ethnocentrism"</span>))
x &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cregg.html">cj</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>(immigration), f1, <span class="dt">id =</span> <span class="op">~</span>CaseID, <span class="dt">estimate =</span> <span class="st">"mm"</span>, <span class="dt">by =</span> <span class="op">~</span>ethnosplit)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(x, <span class="dt">group =</span> <span class="st">"ethnosplit"</span>, <span class="dt">vline =</span> <span class="fl">0.5</span>)</code></pre></div>
<p><img src="Introduction_files/figure-html/conditional_mms-1.png" width="960"></p>
<p>But if we want to interpret differences in the sizes of AMCEs (rather than descriptive differences in preferences), we might be inclined to design a similar visualization, replacing MMs with AMCEs. But in such cases, we cannot comment on the descriptive similarity in preferences across subgroups - only the heterogeneity in causal effects of feature variations. To make (dis)similarity explicit, such visualizations should include an explicit test of differences in effect sizes. Facetting works well:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate conditional AMCEs</span>
amces &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cregg.html">cj</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>(immigration), ChosenImmigrant <span class="op">~</span><span class="st"> </span>ReasonForApplication <span class="op">+</span><span class="st"> </span>LanguageSkills, <span class="dt">id =</span> <span class="op">~</span>CaseID, <span class="dt">estimate =</span> <span class="st">"amce"</span>, 
    <span class="dt">by =</span> <span class="op">~</span>ethnosplit)
diff_amces &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cregg.html">cj</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>(immigration), ChosenImmigrant <span class="op">~</span><span class="st"> </span>ReasonForApplication <span class="op">+</span><span class="st"> </span>LanguageSkills, <span class="dt">id =</span> <span class="op">~</span>CaseID, <span class="dt">estimate =</span> <span class="st">"amce_diff"</span>, 
    <span class="dt">by =</span> <span class="op">~</span>ethnosplit)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(amces, diff_amces)) <span class="op">+</span><span class="st"> </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>(<span class="op">~</span>BY, <span class="dt">ncol =</span> 3L)</code></pre></div>
<p><img src="Introduction_files/figure-html/conditional_amces-1.png" width="960"></p>
<p>But again, this plot showcases differences in conjoint effect sizes (AMCEs) not descriptive differences in underlying preferences. A plot of the differences in MMs might be clearer:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate conditional MMs</span>
mms &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cregg.html">cj</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>(immigration), ChosenImmigrant <span class="op">~</span><span class="st"> </span>ReasonForApplication <span class="op">+</span><span class="st"> </span>LanguageSkills, <span class="dt">id =</span> <span class="op">~</span>CaseID, <span class="dt">estimate =</span> <span class="st">"mm"</span>, <span class="dt">by =</span> <span class="op">~</span>ethnosplit)
diff_mms &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cregg.html">cj</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>(immigration), ChosenImmigrant <span class="op">~</span><span class="st"> </span>ReasonForApplication <span class="op">+</span><span class="st"> </span>LanguageSkills, <span class="dt">id =</span> <span class="op">~</span>CaseID, <span class="dt">estimate =</span> <span class="st">"mm_diff"</span>, 
    <span class="dt">by =</span> <span class="op">~</span>ethnosplit)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(mms, diff_mms)) <span class="op">+</span><span class="st"> </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>(<span class="op">~</span>BY, <span class="dt">ncol =</span> 3L)</code></pre></div>
<p><img src="Introduction_files/figure-html/conditional_differences-1.png" width="960"></p>
<p>And while the inferential differences may be small, the risk of using differences in conditional AMCEs versus differences in MMs is that both the size and even the direction of subgroup differences can be misleading when presented as differences in AMCEs:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diff_amces<span class="op">$</span>Estimate &lt;-<span class="st"> "AMCE Difference"</span>
diff_mms<span class="op">$</span>Estimate &lt;-<span class="st"> "MM Difference"</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(diff_amces, diff_mms), <span class="dt">feature_headers =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>(<span class="op">~</span>Estimate, <span class="dt">ncol =</span> 2L)</code></pre></div>
<p><img src="Introduction_files/figure-html/amce_vs_mm-1.png" width="960"></p>
</div>
</div>
<div id="interactions" class="section level2">
<h2 class="hasAnchor">
<a href="#interactions" class="anchor"></a>Interactions</h2>
<p>This general process is also possible with a profile feature, rather than a respondent characteristic, in the <code>by =</code> argument. This may be necessary when interaction effects are hypothesised. These tell us the causal effect of each level of the RHS features, depending on the value at which another attribute is held. For example, we could check for an interaction between the gender of immigrants and their language skills:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate interaction AMCEs (ACIEs)</span>
amces_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cregg.html">cj</a></span>(immigration, ChosenImmigrant <span class="op">~</span><span class="st"> </span>LanguageSkills, <span class="dt">id =</span> <span class="op">~</span>CaseID, <span class="dt">estimate =</span> <span class="st">"amce"</span>, <span class="dt">by =</span> <span class="op">~</span>Gender)
diff_amces_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cregg.html">cj</a></span>(immigration, ChosenImmigrant <span class="op">~</span><span class="st"> </span>LanguageSkills, <span class="dt">id =</span> <span class="op">~</span>CaseID, <span class="dt">estimate =</span> <span class="st">"amce_diff"</span>, <span class="dt">by =</span> <span class="op">~</span>Gender)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(amces_<span class="dv">2</span>, diff_amces_<span class="dv">2</span>)) <span class="op">+</span><span class="st"> </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>(<span class="op">~</span>BY, <span class="dt">ncol =</span> 3L)</code></pre></div>
<p><img src="Introduction_files/figure-html/interaction_amces-1.png" width="960"></p>
<p>The explicit test of differences in effect sizes tells us that the change in probability of choosing a profile for each level of language skill, <em>relative to the baseline level of fluent English</em>, does not vary significantly contingent on the gender of the profile. For interactions between variables with more levels, however, these plots become large and complex, so it may be better to exclude the explicit tests of differences, which become difficult to interpret:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate interaction AMCEs (ACIEs)</span>
amces_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cregg.html">cj</a></span>(immigration, ChosenImmigrant <span class="op">~</span><span class="st"> </span>LanguageSkills, <span class="dt">id =</span> <span class="op">~</span>CaseID, <span class="dt">estimate =</span> <span class="st">"amce"</span>, <span class="dt">by =</span> <span class="op">~</span>Job)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(amces_<span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>(<span class="op">~</span>BY, <span class="dt">ncol =</span> 3L)</code></pre></div>
<p><img src="Introduction_files/figure-html/interaction_amces_2-1.png" width="960"></p>
<p>While this may be necessary when (causal) interaction <em>effects</em> specifically need to be tested, again inferential errors are very possible with this kind of visualisation of AMCEs. In many cases it may be preferable to report MMs. Here these tell us respondents’ language skill preferences contingent on the job of the profile:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># calculate interaction MMs</span>
mms &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cregg.html">cj</a></span>(immigration, ChosenImmigrant <span class="op">~</span><span class="st"> </span>LanguageSkills, <span class="dt">id =</span> <span class="op">~</span>CaseID, <span class="dt">estimate =</span> <span class="st">"mm"</span>, <span class="dt">by =</span> <span class="op">~</span>Job)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(mms, <span class="dt">vline =</span> <span class="fl">0.5</span>) <span class="op">+</span><span class="st"> </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/facet_wrap">facet_wrap</a></span>(<span class="op">~</span>BY, <span class="dt">ncol =</span> 3L)</code></pre></div>
<p><img src="Introduction_files/figure-html/interaction_mms-1.png" width="960"></p>
<p>Alternatively, new interaction variables can be created using <code><a href="https://www.rdocumentation.org/packages/base/topics/interaction">interaction()</a></code> and then their AMCEs (with inferential caution) or MMs can be plotted like any other variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">immigration<span class="op">$</span>language_entry &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/interaction">interaction</a></span>(immigration<span class="op">$</span>LanguageSkills, immigration<span class="op">$</span>PriorEntry, <span class="dt">sep =</span> <span class="st">"_"</span>)
<span class="co"># average component interaction effects</span>
acies &lt;-<span class="st"> </span><span class="kw"><a href="../reference/amce.html">amce</a></span>(immigration, ChosenImmigrant <span class="op">~</span><span class="st"> </span>language_entry, <span class="dt">id =</span> <span class="op">~</span>CaseID)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(acies)</code></pre></div>
<p><img src="Introduction_files/figure-html/interactions-1.png" width="960"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># higher order MMs</span>
interaction_mms &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mm.html">mm</a></span>(immigration, ChosenImmigrant <span class="op">~</span><span class="st"> </span>language_entry, <span class="dt">id =</span> <span class="op">~</span>CaseID)
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(interaction_mms, <span class="dt">vline =</span> <span class="fl">0.5</span>)</code></pre></div>
<p><img src="Introduction_files/figure-html/interactions-2.png" width="960"></p>
</div>
<div id="diagnostics" class="section level2">
<h2 class="hasAnchor">
<a href="#diagnostics" class="anchor"></a>Diagnostics</h2>
<p>The package provides a number of useful diagnostic functions.</p>
<div id="display-frequencies-and-proportions" class="section level3">
<h3 class="hasAnchor">
<a href="#display-frequencies-and-proportions" class="anchor"></a>Display Frequencies and Proportions</h3>
<p>For example, to check display frequencies of conjoint features (to ensure equal - or unequal - display frequency):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plotting of display frequencies</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../reference/cj_freqs.html">cj_freqs</a></span>(immigration, f1, <span class="dt">id =</span> <span class="op">~</span>CaseID))</code></pre></div>
<p><img src="Introduction_files/figure-html/plot_freqs-1.png" width="960"></p>
<p>As is clear in the above, constraints were imposed in the original study on the allowed combinations of <code>Job</code> and <code>Education</code> and also on combinations of <code>CountryOfOrigin</code> and <code>ReasonForApplication</code>. The <code><a href="../reference/cj_freqs.html">cj_props()</a></code> function provides tidy proportions tables to verify that the design was implemented as intended or to perform further subgroup analyses.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/subset">subset</a></span>(<span class="kw"><a href="../reference/cj_freqs.html">cj_props</a></span>(immigration, <span class="op">~</span>Job <span class="op">+</span><span class="st"> </span>Education, <span class="dt">id =</span> <span class="op">~</span>CaseID), Proportion <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</code></pre></div>
<pre><code>                   Job   Education Proportion
5    Financial Analyst   No Formal          0
8  Computer Programmer   No Formal          0
10  Research Scientist   No Formal          0
11              Doctor   No Formal          0
16   Financial Analyst   4th Grade          0
19 Computer Programmer   4th Grade          0
21  Research Scientist   4th Grade          0
22              Doctor   4th Grade          0
27   Financial Analyst   8th Grade          0
30 Computer Programmer   8th Grade          0
32  Research Scientist   8th Grade          0
33              Doctor   8th Grade          0
38   Financial Analyst High School          0
41 Computer Programmer High School          0
43  Research Scientist High School          0
44              Doctor High School          0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/subset">subset</a></span>(<span class="kw"><a href="../reference/cj_freqs.html">cj_props</a></span>(immigration, <span class="op">~</span>CountryOfOrigin <span class="op">+</span><span class="st"> </span>ReasonForApplication, <span class="dt">id =</span> <span class="op">~</span>CaseID), Proportion <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</code></pre></div>
<pre><code>   CountryOfOrigin ReasonForApplication Proportion
21           India   Escape Persecution          0
22         Germany   Escape Persecution          0
23          France   Escape Persecution          0
24          Mexico   Escape Persecution          0
25     Philippines   Escape Persecution          0
26          Poland   Escape Persecution          0</code></pre>
</div>
<div id="balance-testing" class="section level3">
<h3 class="hasAnchor">
<a href="#balance-testing" class="anchor"></a>Balance Testing</h3>
<p>The main <code><a href="../reference/amce.html">amce()</a></code> and <code><a href="../reference/mm.html">mm()</a></code> functions can also be used for balance testing. Rather than comparing outcomes across feature levels, we will compare a covariate across feature levels. Both approaches will give a similar result:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../reference/mm.html">mm</a></span>(immigration, ethnocentrism <span class="op">~</span><span class="st"> </span>Job <span class="op">+</span><span class="st"> </span>Education <span class="op">+</span><span class="st"> </span>CountryOfOrigin <span class="op">+</span><span class="st"> </span>ReasonForApplication, <span class="dt">id =</span> <span class="op">~</span>CaseID), <span class="dt">xlim =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">10</span>, 
    <span class="dv">30</span>), <span class="dt">vline =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(immigration<span class="op">$</span>ethnocentrism, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre></div>
<p><img src="Introduction_files/figure-html/balance_testing-1.png" width="960"> Given that confidence intervals for each feature hover closely around the grand mean, there is little reason to believe that imbalance is a problem. The same analysis could be performed using <code><a href="../reference/amce.html">amce()</a></code> or, of course, <code><a href="../reference/cregg.html">cj()</a></code> with either estimand specified in <code>estimate =</code>.</p>
</div>
<div id="carryover-and-leftright-diagnostics" class="section level3">
<h3 class="hasAnchor">
<a href="#carryover-and-leftright-diagnostics" class="anchor"></a>Carryover and Left/Right Diagnostics</h3>
<p>Subgroup diagnostics can be used to evaluate whether there is, for example, any preference for the left-hand or right-hand profile (in a two-profile design):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(<span class="kw"><a href="../reference/cregg.html">cj</a></span>(immigration, f1, <span class="dt">id =</span> <span class="op">~</span>CaseID, <span class="dt">by =</span> <span class="op">~</span>profile, <span class="dt">estimate =</span> <span class="st">"mm"</span>), <span class="dt">group =</span> <span class="st">"profile"</span>, <span class="dt">vline =</span> <span class="fl">0.5</span>)</code></pre></div>
<p><img src="Introduction_files/figure-html/leftright-1.png" width="960"></p>
<p>Again, in this example there are no obvious concerns generated from the diagnostic. The same approach can be used to perform other diagnostics, such as detecting carryover problems.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#code-examples">Code Examples</a></li>
      <li><a href="#subgroup-analyis">Subgroup Analyis</a></li>
      <li><a href="#interactions">Interactions</a></li>
      <li><a href="#diagnostics">Diagnostics</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Thomas J. Leeper.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
