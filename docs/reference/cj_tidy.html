<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Tidy a conjoint dataset — cj_tidy • cregg</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Tidy a conjoint dataset — cj_tidy" />
<meta property="og:description" content="Coerce a &amp;#8220;wide&amp;#8221; conjoint dataset into a &amp;#8220;long&amp;#8221;/&amp;#8220;tidy&amp;#8221; one for use with cregg" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cregg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Introduction.html">Introduction to cregg</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/leeper/cregg">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Tidy a conjoint dataset</h1>
    <small class="dont-index">Source: <a href='https://github.com/leeper/cregg/blob/master/R/cj_tidy.R'><code>R/cj_tidy.R</code></a></small>
    <div class="hidden name"><code>cj_tidy.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Coerce a &#8220;wide&#8221; conjoint dataset into a &#8220;long&#8221;/&#8220;tidy&#8221; one for use with cregg</p>
    </div>

    <pre class="usage"><span class='fu'>cj_tidy</span>(<span class='no'>data</span>, <span class='no'>profile_variables</span>, <span class='no'>task_variables</span>, <span class='no'>id</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>A data frame containing a conjoint dataset in &#8220;wide&#8221; format (see Details).</p></td>
    </tr>
    <tr>
      <th>profile_variables</th>
      <td><p>A named list of two-element lists capturing profile-specific variables (either features, or profile-specific outcomes, like rating scales). For each element in the list, the first element contains vectors of feature variable names for the first profile in each decision task (hereafter, profile &#8220;A&#8221;) and the second element contains vectors of feature variable names for the second profile in each decision task (hereafter, profile &#8220;B&#8221;). Variables can be specified as character strings or an RHS formula. The names at the highest level are used to name variables in the long/tidy output.</p></td>
    </tr>
    <tr>
      <th>task_variables</th>
      <td><p>A named list of vectors of variables constituting task-level variables (i.e., variables that differ by task but not across profiles within a task). Variables can be specified as character strings or an RHS formula. These could be outcome variables, response times, etc.</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>An RHS formula specifying a variable holding respondent identifiers.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data frame with rows equal to the number of respondents times the number of tasks times the number of profiles (fixed at 2), to be fed into any other function in the package. The columns will include the names of elements in <code>profile_variables</code> and <code>task_variables</code>, and <code>id</code>, along with an indicator <code>task</code> (from 1 to the number of tasks), <code>pair</code> (an indicator for each task pair from 1 to the number of pairs), <code>profile</code> (a fator indicator for profile, either &#8220;A&#8221; or &#8220;B&#8221;), and any other respondent-varying covariates not specified. As such, respondent-varying variables do not need to be specified to <code>cj_tidy</code> at all.</p>
<p>The returned data frame carries an additional S3 class (&#8220;cj_df&#8221;) with methods that preserve column attributes. See <code><a href='cj_df.html'>cj_df</a></code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>A conjoint survey typically comes to the analyst in a &#8220;wide&#8221; form, where the number of rows is equal to the number of survey respondents and columns represent choices and features for each choice task and task profile. For example, a design with 1000 respondents and five forced-choice decision tasks, with 6 features each, will have 1000 rows and 5x2x6 feature columns, plus five forced-choice outcome variable columns recording which alternative was selected for each task. To analyse these data, the data frame needs to be reshaped to &#8220;long&#8221; or &#8220;tidy&#8221; format, with 1000x5x2 rows, six feature columns, and one outcome column. Multiple outcomes or other task-specific variables would increase the number of columns in the result, as will respondent-varying characteristics which need to be replicated across each decision task and profile.</p>
<p>This a complex operation because variables vary at three levels: respondent, task, and profile. Thus the reshape is not a simple wide-to-long transformation. It instead requires two reshaping steps, one to create a task-level dataset and a further one to create a profile-level dataset. <code>cj_tidy</code> performs this tidying in two steps, through a single function with an easy-to-use API. Users can specify variable names in the <code>wide</code> format using either character vectors of righthand-side (RHS) formulae. They are equivalent but depending on the naming of variables, character vectors can be easier to specify (e.g., using regular expressions for pattern matching).</p>
<p>Particular care is needed to decide whether a particular set of &#8220;wide&#8221; columns belong in <code>profile_variables</code> or <code>task_variables</code>. This especially applies to outcomes variables. If a variable in the original format records <em>which</em> of the two profiles was chosen (e.g., &#8220;left&#8221; and &#8220;right&#8221;), it should go in <code>task_variables</code>. If it records whether a profile was chosen (e.g., for each task there is a &#8220;left_chosen&#8221; and &#8220;right_chosen&#8221; variable), then both variables should go in <code>profile_variables</code> as they vary at the profile level. Similarly, one needs to be careful with the output of <code>cj_tidy</code> to ensure that a task-level variable is further recoded to encode which alternative was selected (see examples).</p>
<p>Users may find that it is easier to recode features <em>after</em> using <code>cj_tidy</code> rather than before, as it requires recoding only a number of variables equal to the number of features in the design, rather than recoding all &#8220;wide&#8221; feature columns before reshaping. Again, however, care should be taken that these variables encode information in the same way so that stacking does not produce a loss of information.</p>
<p>Finally, <code>data</code> should not use the variable names &#8220;task&#8221;, &#8220;pair&#8221;, or &#8220;profile&#8221;, which are the names of metadata columns created by reshaping.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='cregg.html'>cj</a></code>, <code><a href='cj_df.html'>cj_df</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"wide_conjoint"</span>)

<span class='co'># character string interface</span>
<span class='co'>## profile_variables</span>
<span class='no'>list1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
 <span class='kw'>feature1</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
     <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>wide_conjoint</span>)[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span>(<span class='st'>"^feature1.{1}1"</span>, <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>wide_conjoint</span>))],
     <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>wide_conjoint</span>)[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span>(<span class='st'>"^feature1.{1}2"</span>, <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>wide_conjoint</span>))]
 ),
 <span class='kw'>feature2</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
     <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>wide_conjoint</span>)[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span>(<span class='st'>"^feature2.{1}1"</span>, <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>wide_conjoint</span>))],
     <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>wide_conjoint</span>)[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span>(<span class='st'>"^feature2.{1}2"</span>, <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>wide_conjoint</span>))]
 ),
 <span class='kw'>feature3</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
     <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>wide_conjoint</span>)[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span>(<span class='st'>"^feature3.{1}1"</span>, <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>wide_conjoint</span>))],
     <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>wide_conjoint</span>)[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span>(<span class='st'>"^feature3.{1}2"</span>, <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>wide_conjoint</span>))]
 ),
 <span class='kw'>rating</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
     <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>wide_conjoint</span>)[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span>(<span class='st'>"^rating.+1"</span>, <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>wide_conjoint</span>))],
     <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>wide_conjoint</span>)[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span>(<span class='st'>"^rating.+2"</span>, <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>wide_conjoint</span>))]
 )
)
<span class='co'>## task variables</span>
<span class='no'>list2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>choice</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(<span class='st'>"choice_"</span>, <span class='no'>letters</span>[<span class='fl'>1</span>:<span class='fl'>4</span>]),
              <span class='kw'>timing</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(<span class='st'>"timing_"</span>, <span class='no'>letters</span>[<span class='fl'>1</span>:<span class='fl'>4</span>]))

<span class='co'># formula interface</span>
<span class='co'>## profile_variables</span>
<span class='no'>list1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
   <span class='kw'>feature1</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
       ~ <span class='no'>feature1a1</span> + <span class='no'>feature1b1</span> + <span class='no'>feature1c1</span> + <span class='no'>feature1d1</span>,
       ~ <span class='no'>feature1a2</span> + <span class='no'>feature1b2</span> + <span class='no'>feature1c2</span> + <span class='no'>feature1d2</span>
   ),
   <span class='kw'>feature2</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
       ~ <span class='no'>feature2a1</span> + <span class='no'>feature2b1</span> + <span class='no'>feature2c1</span> + <span class='no'>feature2d1</span>,
       ~ <span class='no'>feature2a2</span> + <span class='no'>feature2b2</span> + <span class='no'>feature2c2</span> + <span class='no'>feature2d2</span>
   ),
   <span class='kw'>feature3</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
       ~ <span class='no'>feature3a1</span> + <span class='no'>feature3b1</span> + <span class='no'>feature3c1</span> + <span class='no'>feature3d1</span>,
       ~ <span class='no'>feature3a2</span> + <span class='no'>feature3b2</span> + <span class='no'>feature3c2</span> + <span class='no'>feature3d2</span>
   ),
   <span class='kw'>rating</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(
       ~ <span class='no'>rating_a1</span> + <span class='no'>rating_b1</span> + <span class='no'>rating_c1</span> + <span class='no'>rating_d1</span>,
       ~ <span class='no'>rating_a2</span> + <span class='no'>rating_b2</span> + <span class='no'>rating_c2</span> + <span class='no'>rating_d2</span>
   )
)
<span class='co'># task variables</span>
<span class='no'>list2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>choice</span> <span class='kw'>=</span> ~ <span class='no'>choice_a</span> + <span class='no'>choice_b</span> + <span class='no'>choice_c</span> + <span class='no'>choice_d</span>,
              <span class='kw'>timing</span> <span class='kw'>=</span> ~ <span class='no'>timing_a</span> + <span class='no'>timing_b</span> + <span class='no'>timing_c</span> + <span class='no'>timing_d</span>)


<span class='co'># perform reshape</span>
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span>(<span class='no'>long</span> <span class='kw'>&lt;-</span> <span class='fu'>cj_tidy</span>(<span class='no'>wide_conjoint</span>,
                    <span class='kw'>profile_variables</span> <span class='kw'>=</span> <span class='no'>list1</span>,
                    <span class='kw'>task_variables</span> <span class='kw'>=</span> <span class='no'>list2</span>,
                    <span class='kw'>id</span> <span class='kw'>=</span> ~ <span class='no'>respondent</span>))
<span class='fu'><a href='https://rdrr.io/r/base/stopifnot.html'>stopifnot</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>long</span>) <span class='kw'>==</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span>(<span class='no'>wide_conjoint</span>)*<span class='fl'>4</span>*<span class='fl'>2</span>)

<span class='co'># recode outcome so it is coded sensibly</span>
<span class='no'>long</span>$<span class='no'>chosen</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span>((<span class='no'>long</span>$<span class='no'>profile</span> <span class='kw'>==</span> <span class='st'>"A"</span> <span class='kw'>&amp;</span> <span class='no'>long</span>$<span class='no'>choice</span> <span class='kw'>==</span> <span class='fl'>1</span>) <span class='kw'>|</span>
                       (<span class='no'>long</span>$<span class='no'>profile</span> <span class='kw'>==</span> <span class='st'>"B"</span> <span class='kw'>&amp;</span> <span class='no'>long</span>$<span class='no'>choice</span> <span class='kw'>==</span> <span class='fl'>2</span>), <span class='fl'>1</span>, <span class='fl'>0</span>)
<span class='co'># use for analysis</span>
<span class='fu'><a href='cregg.html'>cj</a></span>(<span class='no'>long</span>, <span class='no'>chosen</span> ~ <span class='no'>feature1</span> + <span class='no'>feature2</span> + <span class='no'>feature3</span>, <span class='kw'>id</span> <span class='kw'>=</span> ~ <span class='no'>respondent</span>)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Thomas J. Leeper.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


